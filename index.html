<!DOCTYPE html>
<html>
<head>
<title>AtJ</title>
<meta charset="utf-8" />
<link rel="stylesheet" href="leaflet.css" />
<script src="leaflet.js"></script>
<script src="dropdown.js"></script>
<script type="text/javascript" src="County_Centroids.js"></script>
<script type="text/javascript" src="us-states.js"></script>
<style>
body {background-color: #aac5ef;}
#map { width: 70%; height: 650px;}
.info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.2); border-radius: 5px;} .info h3 { margin: 0 0 5px; color: #777;}
.legend { text-align: left; line-height: 18px; color: #555; } .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }
#side-panel {
            position: absolute;
			text-align: center;
            left: 70%;
            right: 0;
            top: 0;
            bottom: 0;
            width: 30%;
            background: #000;
            border-left: 2px solid #aac5ef;
            overflow-y: scroll;
        }h1 {
            padding: 8px 15px 8px 15px;
            margin: 0;
            background: #000;
            width: 100%
            font-weight: 350;
            font-size: 1.2em;
            text-align: center;
            color: #adb3bc;
        }
        h2 {
            margin: 0;
            padding: 8px 15px 8px 15px;
            color: #adb3bc;
            font-weight: 500;
            font-size: 1.1em;
            text-align: center;
        }
        h4 {
            padding: 8px 15px 8px 15px;
            margin: 0;
            background: #000;
            width: 100%
            font-weight: 250;
            font-size: .9em;
            text-align: center;
            color: #adb3bc;
            border-bottom: 5px solid #aac5ef;
        }
        h3 {
            padding: 8px 15px 8px 15px;
            margin: 0;
            background: white;
            width: 100%
            font-weight: 250;
            font-size: .9em;
            text-align: center;
            color: #adb3bc;
            border-bottom: 5px solid #aac5ef;
        }
        #side-panel p {
            margin: 8px 0 4px;
            padding: 0 25px 0 15px;
            color: #adb3bc;
            text-align: left;
            font-size: .9em;
            line-height: 1.3em;
        }
</style>
<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
<script src='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css' rel='stylesheet' />
</head>

<body>
<div id="map"></div>


<script type="text/javascript">
////////////////////////////////////////////////////////////////////////////////////////////
//setting up the map//
////////////////////////////////////////////////////////////////////////////////////////////

var map = L.map('map').setView([ 32.836, -83.22], 7);

L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {
	attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
	subdomains: 'abcd',
    id: 'mapbox.dark'
    }).addTo(map);




////////////////////////////////////////////////////////////////////////////////////////////
//adding the data//
////////////////////////////////////////////////////////////////////////////////////////////



//var noIcon = L.icon({
//    iconUrl: 'leaf-green.png',
//	iconSize:[10,10], // size of the icon
//});

//var markerLayer = L.geoJson(stations, {
// onEachFeature: function(feature, layer) {
//    layer.bindPopup(feature.properties.STATION + " County");
//  }}).addTo(map);


var markerLayer = L.geoJson(stations, {
           pointToLayer: function(feature, latlng) {
                var smallIcon = new L.Icon({
					iconSize: [0, 0],
					iconUrl: 'leaf-green.png'
				});
                return L.marker(latlng, {icon: smallIcon});
            },
           onEachFeature: function (feature, layer) {
                   layer.bindPopup(feature.properties.STATION + " County");
           }
         }).addTo(map);

map.fitBounds(markerLayer.getBounds());


////////////////////////////////////////////////////////////////////////////////////////////
//creating the selector control//
////////////////////////////////////////////////////////////////////////////////////////////

//create Leaflet control for selector
var selector = L.control({
  position: 'topright'
});

selector.onAdd = function(map) {
  //create div container
  var div = L.DomUtil.create('div', 'mySelector');
  //create select element within container (with id, so it can be populated later)
  div.innerHTML = '<select id="marker_select"><option value="init">(select county)</option></select>';
  return div;
};

selector.addTo(map);


//have to use eachFeature (instead of onEachFeature) to create selector options
//because _leaflet_id doesn't exist until after each feature is created
markerLayer.eachLayer(function(layer) {
  //create option in selector element
  //with content set to city name
  //and value set to the layer's internal ID
  var optionElement = document.createElement("option");
  optionElement.innerHTML = layer.feature.properties.STATION;
  optionElement.value = layer._leaflet_id;
  L.DomUtil.get("marker_select").appendChild(optionElement);
});



////////////////////////////////////////////////////////////////////////////////////////////
//setting up event listeners//
////////////////////////////////////////////////////////////////////////////////////////////

var marker_select = L.DomUtil.get("marker_select");

//prevent clicks on the selector from propagating through to the map
//(otherwise popups will close immediately after opening)
L.DomEvent.addListener(marker_select, 'click', function(e) {
  L.DomEvent.stopPropagation(e);
});

L.DomEvent.addListener(marker_select, 'change', changeHandler);

function changeHandler(e) {
  if (e.target.value == "init") {
    map.closePopup();
  } else {
    markerLayer.getLayer(e.target.value).openPopup();
  }
}

L.geoJson(statesData).addTo(map);

map.on('popupopen', function(centerMarker) {
        var cM = map.project(centerMarker.popup._latlng);
        cM.y -= centerMarker.popup._container.clientHeight/2
        map.setView(map.unproject(cM),10, {animate: true});
    });
</script>




<script type="text/javascript">

	var info = L.control({position: 'bottomright'});

	info.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'info');
		this.update();
		return this._div;
	};

	info.update = function (props) {
		this._div.innerHTML = '<h4>County Area</h4>' +  (props ?
			'<b>' + props.name + '</b><br />' + props.CENSUSAREA + ' mi<sup>2</sup>'
			: 'Hover over a state');
	};

	info.addTo(map);


	function getColor(d) {
		return d > 1000 ? '#800026' :
				d > 500  ? '#BD0026' :
				d > 200  ? '#E31A1C' :
				d > 100  ? '#FC4E2A' :
				d > 50   ? '#FD8D3C' :
				d > 20   ? '#FEB24C' :
				d > 10   ? '#FED976' :
							'#FFEDA0';
	}

	function style(feature) {
		return {
			weight: 2,
			opacity: 1,
			color: 'white',
			dashArray: '3',
			fillOpacity: 0.0,
			fillColor: getColor(feature.properties.CENSUSAREA)
		};
	}

	function highlightFeature(e) {
		var layer = e.target;

		layer.setStyle({
			weight: 5,
			color: ' #fff',
			dashArray: '',
			fillOpacity: 0.0
		});

		if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}

		info.update(layer.feature.properties);
	}

	var geojson;

	function resetHighlight(e) {
		geojson.resetStyle(e.target);
		info.update();
	}

	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}

	function onEachFeature(feature, layer) {
		layer.on({
			mouseover: highlightFeature,
			mouseout: resetHighlight,
			click: zoomToFeature
		});
	}

	geojson = L.geoJson(statesData, {
		style: style,
		onEachFeature: onEachFeature
	}).addTo(map);


	var legend = L.control({position: 'bottomleft'});

	legend.onAdd = function (map) {

		var div = L.DomUtil.create('div', 'info legend'),
			grades = [0, 10, 20, 50, 100, 200, 500, 1000],
			labels = [],
			from, to;

		for (var i = 0; i < grades.length; i++) {
			from = grades[i];
			to = grades[i + 1];

			labels.push(
				'<i style="background:' + getColor(from + 1) + '"></i> ' +
				from + (to ? '&ndash;' + to : '+'));
		}

		div.innerHTML = labels.join('<br>');
		return div;
	};

	legend.addTo(map);
</script>

<div id="map1"></div>
<script>
	var Courthouses = new L.LayerGroup();

	L.marker([33.7740, -84.2974]).bindPopup('DeKalb County Courthouse.').addTo(Courthouses),
	L.marker([33.7504, -84.3906]).bindPopup('Fulton County Courthouse.').addTo(Courthouses),
	L.marker([32.0792, -81.0972]).bindPopup('Chatham County Courthouse').addTo(Courthouses),
	L.marker([32.8385, -83.6279]).bindPopup('Bibb County Courthouse.').addTo(Courthouses),
	L.marker([34.8787034, -83.4018266]).bindPopup('Rabun County Courthouse<br>25 Courthouse Square<br>Clayton, GA').addTo(Courthouses),
	L.marker([33.9600, -883.3754]).bindPopup('Clarke County Courthouse.').addTo(Courthouses);

	var mbAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

	var grayscale   = L.tileLayer(mbUrl, {
								maxZoom: 19,
    							minZoom: 7,
								id: 'mapbox.light',
								attribution: mbAttr}),
		streets  = L.tileLayer(mbUrl, {
								maxZoom: 19,
    							minZoom: 7,
								id: 'mapbox.streets',
								attribution: mbAttr});
	var baseLayers = {
		"Grayscale": grayscale,
		"Streets": streets
	};

	var overlays = {
		"Courthouses": Courthouses

	};


	L.control.layers(baseLayers, overlays).addTo(map);
</script>

<style>
.menu-ui {
  position:right;
  top:10px;
  right:10px;
  }

/* Do a fancy data transition for browsers that support it */
path {
  -webkit-transition:fill 200ms;
          transition:fill 200ms;
  }
</style>


<script src='https://code.jquery.com/jquery-1.11.0.min.js'></script>


<script>

// Choropleth colors from http://colorbrewer2.org/
// You can choose your own range (or different number of colors)
// and the code will compensate.
var hues = [
    '#eff3ff',
    '#bdd7e7',
    '#6baed6',
    '#3182bd',
    '#08519c'];

// The names of variables that we'll show in the UI for
// styling. These need to match exactly.
var variables = [
    'Active Lawyers',
    'Inactive Lawyers',
    'Emeritus Lawyers'];

// Collect the range of each variable over the full set, so
// we know what to color the brightest or darkest.
var ranges = {};
var $select = $('<select></select>')
    .appendTo($('#variables'))
    .on('change', function() {
        setVariable($(this).val());
    });
for (var i = 0; i < variables.length; i++) {
    ranges[variables[i]] = { min: Infinity, max: -Infinity };
    // Simultaneously, build the UI for selecting different
    // ranges
    $('<option></option>')
        .text(variables[i])
        .attr('value', variables[i])
        .appendTo($select);
}

// Create a layer of state features, and when it's done
// loading, run loadData
var usLayer = L.mapbox.featureLayer()
    .loadURL('us-states.js')
    .addTo(map)
    .on('ready', loadData);

// Grab the spreadsheet of data as JSON. If you have CSV
// data, you should convert it to JSON with
// http://shancarter.github.io/mr-data-converter/
function loadData() {
    $.getJSON('us-states.json')
        .done(function(data) {
            joinData(data, usLayer);
        });
}

function joinData(data, layer) {
    // First, get the US state GeoJSON data for reference.
    var usGeoJSON = usLayer.getGeoJSON(),
        byState = {};

    // Rearrange it so that instead of being a big array,
    // it's an object that is indexed by the state name,
    // that we'll use to join on.
    for (var i = 0; i < usGeoJSON.features.length; i++) {
        byState[usGeoJSON.features[i].properties.name] =
            usGeoJSON.features[i];
    }
    for (i = 0; i < data.length; i++) {
        // Match the GeoJSON data (byState) with the tabular data
        // (data), replacing the GeoJSON feature properties
        // with the full data.
        byState[data[i].name].properties = data[i];
        for (var j = 0; j < variables.length; j++) {
            // Simultaneously build the table of min and max
            // values for each attribute.
            var n = variables[j];
            ranges[n].min = Math.min(data[i][n], ranges[n].min);
            ranges[n].max = Math.max(data[i][n], ranges[n].max);
        }
    }
    // Create a new GeoJSON array of features and set it
    // as the new usLayer content.
    var newFeatures = [];
    for (i in byState) {
        newFeatures.push(byState[i]);
    }
    usLayer.setGeoJSON(newFeatures);
    // Kick off by filtering on an attribute.
    setVariable(variables[0]);
}

// Excuse the short function name: this is not setting a JavaScript
// variable, but rather the variable by which the map is colored.
// The input is a string 'name', which specifies which column
// of the imported JSON file is used to color the map.
function setVariable(name) {
    var scale = ranges[name];
    usLayer.eachLayer(function(layer) {
        // Decide the color for each state by finding its
        // place between min & max, and choosing a particular
        // color as index.
        var division = Math.floor(
            (hues.length - 1) *
            ((layer.feature.properties[name] - scale.min) /
            (scale.max - scale.min)));
        // See full path options at
        // http://leafletjs.com/reference.html#path
        layer.setStyle({
            fillColor: hues[division],
            fillOpacity: 0.8,
            weight: 0.5
        });
    });
}

</script>

<script>
var picker = L.control({position: 'bottomleft'});
picker.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info legend');
    div.innerHTML = '<select><option>Active</option><option>Inactive</option><option>Emeritus</option></select>';
    div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
    return div;
};
picker.addTo(map);



function getColor(d) {
	return d > 1000 ? '#800026' :
			d > 500  ? '#BD0026' :
			d > 200  ? '#E31A1C' :
			d > 100  ? '#FC4E2A' :
			d > 50   ? '#FD8D3C' :
			d > 20   ? '#FEB24C' :
			d > 10   ? '#FED976' :
						'#FFEDA0';
}

function style(feature) {
	return {
		weight: 2,
		opacity: 1,
		color: 'white',
		dashArray: '3',
		fillOpacity: 0.7,
		fillColor: getColor(feature.properties.COUNTY)
	};
}

var geojson;

geojson = L.geoJson(statesData, {
	style: style,
	onEachFeature: onEachFeature
}).addTo(map);

</script>

<div id='side-panel'>
    <h1>Access to Justice</h1>
    <h4>Legal Representation in Georgia</h4>
    <p>This map displays the various degrees to which legal rerpresentation is available in the state of Georgia. Each county is colored according to the chosen statistic (bottom left) such as the total number of Active Lawyers in the county or the percent of the state's lawyers which reside in the county.</p>
    <h2>About </h2>
        <p>The Access to Justice group is a collaboration between .</p>
        <p><a href = "http://i.imgur.com/bI0pMCM.png"><img src="images/eth-cc.png" alt="legend"></a></p>
    <h2>About the data</h2>
        <p>Data for crop start </p>
        <p>Map authored by Charles Wigington, March 2017.</p>
    </div>

</body>
